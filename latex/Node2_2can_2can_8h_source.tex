\doxysection{can.\+h}
\hypertarget{Node2_2can_2can_8h_source}{}\label{Node2_2can_2can_8h_source}\index{Node2/can/can.h@{Node2/can/can.h}}
\mbox{\hyperlink{Node2_2can_2can_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Struct\ with\ bit\ timing\ information}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ See\ \`{}can\_init`\ for\ usage\ example}}
\DoxyCodeLine{00008\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{Node2_2can_2can_8h_a56381b86c0338719f1279aac5ff5d47b}{CanInit}}\ \mbox{\hyperlink{Node2_2can_2can_8h_a56381b86c0338719f1279aac5ff5d47b}{CanInit}};}
\DoxyCodeLine{00009\ \mbox{\hyperlink{Node2_2can_2can_8h_aaeee74663f9c00f2b937a4e55c118776}{\_\_attribute\_\_}}((packed))\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{Node2_2can_2can_8h_a56381b86c0338719f1279aac5ff5d47b}{CanInit}}\ \{}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{00011\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ phase2:4;\ \ \textcolor{comment}{//\ Phase\ 2\ segment}}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ phase1:4;\ \ \textcolor{comment}{//\ Phase\ 1\ segment}}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ propag:4;\ \ \textcolor{comment}{//\ Propagation\ time\ segment}}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ sjw:4;\ \ \ \ \ \textcolor{comment}{//\ Synchronization\ jump\ width}}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ brp:8;\ \ \ \ \ \textcolor{comment}{//\ Baud\ rate\ prescaler}}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ smp:8;\ \ \ \ \ \textcolor{comment}{//\ Sampling\ mode}}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ uint32\_t\ reg;}
\DoxyCodeLine{00020\ \ \ \ \ \};}
\DoxyCodeLine{00021\ \};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{comment}{//\ Initialize\ CAN\ bus,\ with\ bit\ timings\ and\ optional\ interrupt}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ If\ \`{}rxInterrupt`\ is\ not\ 0,\ an\ interrupt\ will\ be\ triggered\ when\ a\ message\ is\ received.}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ (See\ can.c\ for\ an\ example\ interrupt\ handler)}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ Example:}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ \ \ \ can\_init((CanInit)\{.brp\ =\ F\_CPU/2000000-\/1,\ .phase1\ =\ 5,\ .phase2\ =\ 1,\ .propag\ =\ 6\},\ 0);}}
\DoxyCodeLine{00029\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{pingpong_2CAN_2can_8c_ac7781a37ca14c5bf42c4fe9de1f4daa8}{can\_init}}(\mbox{\hyperlink{Node2_2can_2can_8h_a56381b86c0338719f1279aac5ff5d47b}{CanInit}}\ init,\ uint8\_t\ rxInterrupt);}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{comment}{//\ Strict-\/aliasing-\/safe\ reinterpret-\/cast}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#define\ union\_cast(type,\ x)\ \(\backslash\)}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{(((union\ \{\ \(\backslash\)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \ \ typeof(x)\ a;\ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ type\ b;\ \(\backslash\)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\})x).b)}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{comment}{//\ Dummy\ type\ for\ use\ with\ \`{}union\_cast`,\ see\ below}}
\DoxyCodeLine{00041\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structByte8}{Byte8}}\ \mbox{\hyperlink{structByte8}{Byte8}};}
\DoxyCodeLine{00042\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structByte8}{Byte8}}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{structByte8_a0ce0887d22b8d7f67482f934e2b58155}{bytes}}[8];}
\DoxyCodeLine{00044\ \};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{//\ CAN\ message\ data\ type}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ Data\ fields\ have\ 3\ access\ methods\ (via\ union):}}
\DoxyCodeLine{00049\ \textcolor{comment}{//\ \ 8\ bytes}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ \ 2\ double\ words\ (32-\/bit\ ints)}}
\DoxyCodeLine{00051\ \textcolor{comment}{//\ \ 1\ Byte8\ dummy\ struct}}
\DoxyCodeLine{00052\ \textcolor{comment}{//\ The\ dummy\ struct\ allows\ for\ convenient\ construction\ of\ a\ CAN\ message\ from\ another\ type}}
\DoxyCodeLine{00053\ \textcolor{comment}{//}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ Example:}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ \ \ \ typedef\ struct\ \{}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ \ \ \ \ \ \ \ uint16\_t\ \ a;}}
\DoxyCodeLine{00057\ \textcolor{comment}{//\ \ \ \ \ \ \ \ uint8\_t\ \ \ b;}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ \ \ \ \ \ \ \ float\ \ \ \ \ c;}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ \ \ \ \}\ \_\_attribute\_\_((packed))\ YourStruct\ ;}}
\DoxyCodeLine{00060\ \textcolor{comment}{//}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ \ \ \ CanMsg\ m\ =\ (CanMsg)\{}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ \ \ \ \ \ \ \ .id\ =\ 1,}}
\DoxyCodeLine{00063\ \textcolor{comment}{//\ \ \ \ \ \ \ \ .length\ =\ sizeof(YourStruct),}}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ \ \ \ \ \ \ \ .byte8\ =\ union\_cast(Byte8,\ ((YourStruct)\{}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ .a\ =\ 10,}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ .b\ =\ 20,}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ .c\ =\ -\/30.0,}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \})),}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ \ \ \ \};}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ \ \ \ can\_printmsg(m);}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ \ \ \ //\ Should\ print:\ CanMsg(id:1,\ length:7,\ data:\{10,\ 0,\ 20,\ 0,\ 0,\ 240,\ 193\})}}
\DoxyCodeLine{00072\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structCanMsg}{CanMsg}}\ \mbox{\hyperlink{structCanMsg}{CanMsg}};}
\DoxyCodeLine{00073\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structCanMsg}{CanMsg}}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{structCanMsg_a8a924fca9e4438a5423a7d8f900a2a88}{id}};}
\DoxyCodeLine{00075\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{structCanMsg_afc2d67b658cf32684d384f84ed354c99}{length}};}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ uint8\_t\ \ \ \ \ \textcolor{keywordtype}{byte}[8];}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ uint32\_t\ \ \ \ \mbox{\hyperlink{structCanMsg_a687d3d021925ebb09f346e768b13a49e}{dword}}[2];}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structByte8}{Byte8}}\ \ \ \ \ \ \ \mbox{\hyperlink{structCanMsg_a8a16f41739789a4b2bd23885116ee9f8}{byte8}};}
\DoxyCodeLine{00080\ \ \ \ \ \};}
\DoxyCodeLine{00081\ \};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{comment}{//\ Send\ a\ CAN\ message\ on\ the\ bus.}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ Blocks\ if\ the\ bus\ does\ not\ receive\ the\ message\ (typically\ because\ one\ of\ the}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ receiving\ nodes\ has\ not\ cleared\ a\ buffer)}}
\DoxyCodeLine{00086\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{Node2_2can_2can_8h_ae568954e77ce3fb11c7ef471688dca6b}{can\_tx}}(\mbox{\hyperlink{structCanMsg}{CanMsg}}\ m);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{comment}{//\ Receive\ a\ CAN\ message.}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ Does\ not\ block.\ Returns\ 0\ if\ there\ is\ no\ message,\ 1\ otherwise}}
\DoxyCodeLine{00090\ uint8\_t\ \mbox{\hyperlink{Node2_2can_2can_8h_a7f8a1b2bf5b7ffef9b246a229bfb1f4e}{can\_rx}}(\mbox{\hyperlink{structCanMsg}{CanMsg}}*\ m);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \textcolor{comment}{//\ Print\ a\ CAN\ message\ (using\ \`{}printf`)}}
\DoxyCodeLine{00093\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{Node2_2can_2can_8h_aabcdcd665e7d981aaedd3ba9e17aaca6}{can\_printmsg}}(\mbox{\hyperlink{structCanMsg}{CanMsg}}\ m);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{Node2_2can_2can_8h_a6f181c8dbd636490638bf5a81524db51}{print\_can\_error}}();}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ }

\end{DoxyCode}
